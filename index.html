<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>War Machine Optimizer</title>
		<link rel="icon" type="image/x-icon" href="./img/ui/Component_Cog.webp" />
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
		<style>
			html {
				scrollbar-gutter: stable;
			}

			/* Header gradient background */
			.header-gradient {
				background: linear-gradient(135deg, rgba(13, 110, 253, 0.1) 0%, rgba(13, 110, 253, 0.05) 100%);
			}

			/* Card hover effect */
			.card-hover:hover {
				box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
				transition: all 0.2s ease;
			}

			.list-group-item.active,
			.list-group-item.active * {
				color: whitesmoke !important;
				background-color: rgb(38, 63, 110);
			}

			/* Sticky optimize section gradient */
			.optimize-section {
				background: linear-gradient(to top, var(--bs-body-bg) 80%, transparent);
			}

			/* Mode selector custom styling */
			.mode-selector {
				display: inline-flex;
				background: rgba(255, 255, 255, 0.05);
				border: 1px solid rgba(255, 255, 255, 0.1);
			}

			.mode-selector input[type="radio"] {
				display: none;
			}

			.mode-selector label {
				cursor: pointer;
				transition: all 0.2s ease;
				color: rgba(255, 255, 255, 0.6);
				margin: 0;
			}

			.mode-selector label:hover {
				background: rgba(255, 255, 255, 0.08);
				color: rgba(255, 255, 255, 0.9);
			}

			.mode-selector input[type="radio"]:checked + label {
				background: rgba(13, 110, 253, 0.2);
				color: #fff;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			}

			/* Optimize button hover effect */
			#optimizeBtn:hover:not(:disabled) {
				transform: translateY(-2px);
				box-shadow: 0 6px 16px rgba(255, 193, 7, 0.4);
			}

			#optimizeBtn:active:not(:disabled) {
				transform: translateY(0);
			}

			/* MACHINE CARDS */
			.machine-card {
				position: relative;
				background: rgba(0, 0, 0, 0.3);
				backdrop-filter: blur(10px);
				border: 1px solid rgba(255, 255, 255, 0.1);
				transition: all 0.3s ease;
				min-width: 280px; /* Prevent width jumping */
			}

			.machine-card:hover {
				transform: translateY(-4px);
				box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
				border-color: rgba(255, 255, 255, 0.2);
			}

			.machine-card .machine-image {
				width: 100px;
				height: 100px;
				object-fit: cover;
				border-radius: 12px;
				transition: all 0.3s ease;
				border: 2px solid rgba(255, 255, 255, 0.1);
			}

			.machine-card:hover .machine-image {
				transform: scale(1.05);
			}

			.machine-card .machine-name {
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 6px;
				text-align: center;
			}

			.rank-particles {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				height: 120px;
				pointer-events: none;
				z-index: 1;
				overflow: hidden;
			}

			/* Individual rank particles */
			.rank-particle {
				position: absolute;
				width: 5px;
				height: 5px;
				border-radius: 50%;
				animation: particleFall linear infinite;
				opacity: 0;
			}

			/* Particle colors by rank */
			.rank-particle.celestial {
				background: radial-gradient(circle, rgba(175, 246, 248, 0.8), rgba(255, 215, 0, 0) 70%);
			}

			.rank-particle.titan {
				background: radial-gradient(circle, rgba(228, 189, 83, 0.8), rgba(138, 43, 226, 0) 70%);
			}

			.rank-particle.angel {
				background: radial-gradient(circle, rgba(252, 163, 163, 0.7), rgba(255, 255, 255, 0) 70%);
			}

			@keyframes particleFall {
				0% {
					transform: translateY(-10px);
					opacity: 0;
				}
				10% {
					opacity: 0.6;
				}
				90% {
					opacity: 0.3;
				}
				100% {
					transform: translateY(120px);
					opacity: 0;
				}
			}

			/* Enhanced glow for special rank cards */
			.machine-card.special-rank-card {
				box-shadow: 0 0 12px rgba(255, 255, 255, 0.08);
			}

			.machine-card.special-rank-card:hover {
				box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4), 0 0 18px rgba(255, 255, 255, 0.12);
			}

			/* Stats grid for machine cards */
			.stats-grid {
				display: grid;
				grid-template-columns: repeat(3, 1fr);
				gap: 7px;
				padding: 7px;
				background: rgba(255, 255, 255, 0.01);
				border-radius: 8px;
				border: 1px solid rgba(255, 255, 255, 0.08);
			}

			.stat-item {
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 4px;
				padding: 6px;
				background: rgba(255, 255, 255, 0.02);
				border-radius: 6px;
				transition: all 0.2s ease;
				min-height: 60px; /* Consistent height */
			}

			.stat-item:hover {
				background: rgba(255, 255, 255, 0.05);
				transform: translateY(-2px);
			}

			.stat-icon {
				width: 22px;
				height: 22px;
				filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
			}

			.stat-value {
				font-size: 0.8rem;
				font-weight: 600;
				color: rgba(255, 255, 255, 0.9);
				text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
				font-family: "Courier New", monospace; /* Monospace for consistent width */
				min-width: 65px; /* Reserve space for exponent notation */
				text-align: center;
			}

			/* Crew section styling */
			.crew-section {
				padding-top: 12px;
			}

			.crew-header {
				font-size: 0.65rem;
				font-weight: 600;
				letter-spacing: 0.5px;
				text-transform: uppercase;
				color: rgba(255, 255, 255, 0.5);
				text-align: center;
			}

			.crew-members img {
				width: 36px;
				height: 36px;
				border-radius: 8px;
				border: 2px solid rgba(255, 255, 255, 0.2);
				transition: all 0.2s ease;
				box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
			}

			.crew-members img:hover {
				transform: scale(1.15);
				border-color: rgba(255, 255, 255, 0.4);
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
				z-index: 10;
			}

			/* RANK ICONS */
			.rank-icon {
				filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
				transition: transform 0.2s ease;
				image-rendering: -webkit-optimize-contrast;
				image-rendering: crisp-edges;
			}

			.rank-icon:hover {
				transform: scale(1.1);
			}

			/* GUARDIAN RANK SELECTOR */
			.guardian-rank-selector-container {
				position: relative;
			}

			.guardian-rank-display {
				display: flex;
				align-items: center;
				padding: 0.5rem 1rem;
			}

			.guardian-rank-dropdown {
				position: absolute;
				top: 100%;
				left: 0;
				right: 0;
				background: var(--bs-body-bg);
				border: 1px solid var(--bs-border-color);
				border-radius: 0.375rem;
				margin-top: 0.25rem;
				max-height: 400px;
				overflow-y: auto;
				z-index: 1000;
				box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.3);
			}

			.guardian-rank-type-header {
				padding: 0.75rem 1rem;
				font-weight: 700;
				font-size: 1.1rem;
				background: rgba(13, 110, 253, 0.15);
				border-bottom: 2px solid rgba(13, 110, 253, 0.3);
				color: #4dabf7;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}

			.guardian-rank-evolution-subheader {
				padding: 0.5rem 1rem;
				font-weight: 600;
				font-size: 0.9rem;
				background: rgba(255, 255, 255, 0.03);
				border-bottom: 1px solid var(--bs-border-color);
				text-transform: capitalize;
				color: rgba(255, 255, 255, 0.7);
			}

			.guardian-rank-options {
				display: grid;
				grid-template-columns: repeat(5, 1fr);
				gap: 0.25rem;
				padding: 0.5rem;
				background: rgba(0, 0, 0, 0.2);
			}

			.guardian-rank-option {
				background: rgba(255, 255, 255, 0.05);
				border: 1px solid rgba(255, 255, 255, 0.1);
				border-radius: 0.25rem;
				padding: 0.5rem;
				cursor: pointer;
				transition: all 0.2s ease;
				display: flex;
				justify-content: center;
				align-items: center;
			}

			.guardian-rank-option:hover {
				background: rgba(13, 110, 253, 0.2);
				border-color: rgba(13, 110, 253, 0.5);
				transform: scale(1.05);
			}

			.guardian-rank-option:active {
				transform: scale(0.95);
			}

			.guardian-rank-dropdown::-webkit-scrollbar {
				width: 8px;
			}

			.guardian-rank-dropdown::-webkit-scrollbar-track {
				background: rgba(255, 255, 255, 0.05);
				border-radius: 4px;
			}

			.guardian-rank-dropdown::-webkit-scrollbar-thumb {
				background: rgba(255, 255, 255, 0.2);
				border-radius: 4px;
			}

			.guardian-rank-dropdown::-webkit-scrollbar-thumb:hover {
				background: rgba(255, 255, 255, 0.3);
			}

			/* Rank display in results */
			.results-view .rank-icon {
				margin: 0 1px;
			}

			/* Fade-in animation */
			.machine-detail-view,
			.hero-detail-view,
			.artifacts-view,
			.tavern-view,
			.scarab-view,
			.results-view {
				animation: fadeIn 0.3s ease-in;
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}
		</style>
	</head>

	<body>
		<div class="container-xxl py-4">
			<!-- Header -->
			<header class="header-gradient border-bottom rounded-3 p-4 mb-4">
				<div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
					<span class="fs-4 fw-bold">War Machine Optimizer</span>
					<div class="d-flex align-items-center gap-2">
						<!-- Settings Button -->
						<button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#settingsModal" title="Settings">
							<i class="bi bi-gear-fill"></i>
						</button>

						<!-- Profile Selector -->
						<div id="profileSelector" class="dropdown"></div>

						<!-- Rest / Save/Load Buttons -->
						<button type="button" id="resetAllBtn" class="btn btn-danger">Reset Profile</button>
						<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#saveLoadModal">Save / Load</button>
					</div>
				</div>
			</header>

			<!-- Save/Load Modal -->
			<div class="modal fade" id="saveLoadModal" tabindex="-1">
				<div class="modal-dialog modal-lg modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Save / Load Configuration</h5>
							<button type="button" class="btn-close user-select-none" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body">
							<p class="text-secondary small">Click <strong>Save</strong> to generate JSON, then copy it. Paste saved JSON here and click <strong>Load</strong> to restore.</p>
							<textarea id="saveLoadBox" class="form-control font-monospace" rows="12" placeholder="generate a save or insert one here..."></textarea>
						</div>
						<div class="modal-footer">
							<button id="saveBtn" type="button" class="btn btn-success user-select-none">Save</button>
							<button id="loadBtn" type="button" class="btn btn-primary user-select-none">Load</button>
							<button type="button" class="btn btn-secondary user-select-none" data-bs-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>

			<!-- Settings Modal -->
			<div class="modal fade" id="settingsModal" tabindex="-1">
				<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title"><i class="bi bi-gear-fill me-2"></i>Settings</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body" id="settingsModalBody">
							<!-- Content populated by renderSettingsModal() -->
						</div>
						<div class="modal-footer">
							<button type="button" id="resetSettingsBtn" class="btn btn-outline-danger">Reset to Defaults</button>
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="button" id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
						</div>
					</div>
				</div>
			</div>

			<!-- Profiles -->
			<div class="modal fade" id="manageProfilesModal" tabindex="-1">
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Manage Profiles</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body">
							<p class="text-secondary small mb-3">Profiles allow you to manage multiple accounts. Each profile stores its own machines, heroes, and settings independently.</p>
							<div id="profileManagementList"></div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>

			<!-- Navigation -->
			<nav class="navbar mt-3">
				<ul class="nav nav-tabs w-100 justify-content-center gap-2 p-2 rounded-3 bg-body-tertiary bg-opacity-25" id="wmTabs">
					<li class="nav-item">
						<a class="nav-link active px-3 py-2 fw-semibold rounded-2 user-select-none" draggable="false" data-bs-toggle="tab" href="#machinesTab">Machines</a>
					</li>
					<li class="nav-item">
						<a class="nav-link px-3 py-2 fw-semibold rounded-2 user-select-none" draggable="false" data-bs-toggle="tab" href="#tavernTab">Tavern</a>
					</li>
					<li class="nav-item">
						<a class="nav-link px-3 py-2 fw-semibold rounded-2 user-select-none" draggable="false" data-bs-toggle="tab" href="#heroesTab">Heroes</a>
					</li>
					<li class="nav-item">
						<a class="nav-link px-3 py-2 fw-semibold rounded-2 user-select-none" draggable="false" data-bs-toggle="tab" href="#artifactsTab">Artifacts</a>
					</li>
					<li class="nav-item">
						<a class="nav-link px-3 py-2 fw-semibold rounded-2 user-select-none" draggable="false" data-bs-toggle="tab" href="#resultsTab">Results</a>
					</li>
					<li class="nav-item">
						<a class="nav-link px-3 py-2 fw-semibold rounded-2 user-select-none" draggable="false" data-bs-toggle="tab" href="#guardianTab">Guardian</a>
					</li>
				</ul>
			</nav>

			<!-- Main Content -->
			<main class="container-fluid tab-content py-4">
				<!-- MACHINES TAB -->
				<section id="machinesTab" class="tab-pane fade show active">
					<!-- Global Bonuses -->
					<div class="card card-hover mb-4 bg-success bg-opacity-10 border-success border-opacity-25">
						<div class="card-body">
							<h5 class="card-title mb-3">Global Bonuses</h5>
							<div class="row g-3">
								<div class="col-12 col-md-6">
									<label for="engineerLevel" class="form-label">Engineer Level</label>
									<input type="number" id="engineerLevel" class="form-control" min="0" step="1" value="0" />
								</div>
								<div class="col-12 col-md-6">
									<label for="scarabLevel" class="form-label">Scarab Level</label>
									<input type="number" id="scarabLevel" class="form-control" min="0" step="1" value="0" />
								</div>
								<div class="col-12 col-md-6">
									<label for="riftRank" class="form-label">Chaos Rift Rank</label>
									<select id="riftRank" class="form-select">
										<!-- Populated through App.js -->
									</select>
								</div>
							</div>
						</div>
					</div>

					<!-- Machine List and Details -->
					<div class="row g-3">
						<div class="col-12 col-lg-4">
							<div class="card card-hover">
								<div class="card-header">
									<h5 class="mb-0">Machine List</h5>
								</div>
								<div class="card-body p-0">
									<div id="machineList" class="list-group list-group-flush overflow-auto" style="max-height: 600px"></div>
								</div>
							</div>
						</div>

						<div class="col-12 col-lg-8">
							<div class="card card-hover">
								<div class="card-header">
									<h5 class="mb-0">Machine Details</h5>
								</div>
								<div class="card-body">
									<div id="machineDetails"></div>
								</div>
							</div>
						</div>
					</div>
				</section>

				<!-- TAVERN TAB -->
				<section id="tavernTab" class="tab-pane fade">
					<div class="mb-4">
						<h4 class="mb-1">Tavern & Scarab's Game</h4>
						<p class="text-secondary mb-0">Manage card levels for all machines</p>
					</div>

					<!-- Sub-tabs for Tavern and Scarab's Game -->
					<div class="d-flex justify-content-center mb-4">
						<div class="mode-selector gap-2 p-2 rounded-3 shadow">
							<input type="radio" id="tavernSubTab" name="tavernMode" value="tavern" checked />
							<label for="tavernSubTab" class="px-4 py-2 rounded-2 fw-medium user-select-none">Tavern (Sacred Cards)</label>

							<input type="radio" id="scarabSubTab" name="tavernMode" value="scarab" />
							<label for="scarabSubTab" class="px-4 py-2 rounded-2 fw-medium user-select-none">Scarab's Game (Inscription Cards)</label>
						</div>
					</div>

					<!-- Tavern Content -->
					<div id="tavernCardsContainer"></div>

					<!-- Scarab Content -->
					<div id="scarabCardsContainer" class="d-none"></div>
				</section>

				<!-- HEROES TAB -->
				<section id="heroesTab" class="tab-pane fade">
					<div class="row g-3">
						<div class="col-12 col-lg-4">
							<div class="card card-hover">
								<div class="card-header">
									<h5 class="mb-0">Hero List</h5>
								</div>
								<div class="card-body p-0">
									<div id="heroList" class="list-group list-group-flush overflow-auto" style="max-height: 600px"></div>
								</div>
							</div>
						</div>

						<div class="col-12 col-lg-8">
							<div class="card card-hover">
								<div class="card-header">
									<h5 class="mb-0">Hero Details</h5>
								</div>
								<div class="card-body">
									<div id="heroDetails"></div>
								</div>
							</div>
						</div>
					</div>
				</section>

				<!-- ARTIFACTS TAB -->
				<section id="artifactsTab" class="tab-pane fade">
					<div class="mb-4 d-flex justify-content-between align-items-center">
						<div>
							<h4 class="mb-1">Artifact Configuration</h4>
							<p class="text-secondary mb-0">Configure artifacts by stat type and percentage tier</p>
						</div>
						<button type="button" class="btn btn-sm btn-outline-danger" id="resetArtifacts">Reset All</button>
					</div>
					<div id="artifactsContainer" class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3 artifacts-view"></div>
				</section>

				<!-- RESULTS TAB -->
				<section id="resultsTab" class="tab-pane fade">
					<div class="card p-4 bg-body-tertiary bg-opacity-25">
						<h4 class="mb-3">Optimization Results</h4>
						<p class="text-secondary">Click the <strong>Optimize</strong> button to calculate your best formation.</p>
						<div id="resultsContainer"></div>
					</div>
				</section>

				<!-- GUARDIAN TAB -->
				<section id="guardianTab" class="tab-pane fade">
					<div class="mb-4">
						<h4 class="mb-1">Guardian Calculator</h4>
						<p class="text-secondary mb-0">Calculate Strange Dust needed to level up your Guardian</p>
					</div>
					<div id="guardianContainer"></div>
				</section>
			</main>

			<!-- Toast Container -->
			<div aria-live="polite" aria-atomic="true">
				<div id="toastRoot" class="toast-container position-fixed bottom-0 end-0 p-3"></div>
			</div>

			<!-- Footer -->
			<footer class="text-center mt-5 pt-4 border-top border-opacity-10 text-white-50">
				<small>Â© 2025 War Machine Optimizer</small>
			</footer>
		</div>

		<!-- OPTIMIZE SECTION (Sticky) -->
		<div class="optimize-section py-4 sticky-bottom">
			<div class="d-flex flex-column align-items-center gap-3">
				<div class="mode-selector gap-2 p-2 rounded-3 shadow">
					<input type="radio" id="campaignMode" name="optimizeMode" value="campaign" checked />
					<label for="campaignMode" class="px-4 py-2 rounded-2 fw-medium user-select-none">Campaign</label>

					<input type="radio" id="arenaMode" name="optimizeMode" value="arena" />
					<label for="arenaMode" class="px-4 py-2 rounded-2 fw-medium user-select-none">Arena</label>
				</div>

				<button
					id="optimizeBtn"
					class="btn btn-warning btn-lg fw-semibold shadow px-5 py-3"
					style="min-width: 200px; font-size: 1.1rem; letter-spacing: 0.02em; box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3); transition: all 0.2s ease">
					Optimize for Campaign
				</button>
			</div>
		</div>

		<!-- Templates -->
		<template id="machineTemplate">
			<div class="machine-card rounded-3 p-4 text-center">
				<img class="machine-image mx-auto d-block mb-3" src="" alt="Machine" />
				<div class="machine-name mb-3"></div>
				<div class="machine-stats"></div>
				<div class="crew"></div>
			</div>
		</template>

		<!-- Bootstrap 5.3.8 -->
		<script src="js/vendor/bootstrap.bundle.min.js"></script>
		<script type="module" src="js/app.js"></script>
	</body>
</html>
